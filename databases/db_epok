//testdatabas flera


const Database = require('better-sqlite3');
const http = require('http');
const db = new Database('epok.db');





// skapa databas








db.prepare(`
CREATE TABLE IF NOT EXISTS modul (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    kurskod TEXT NOT NULL,
    modulkod TEXT NOT NULL,
    benamning TEXT NOT NULL,
    tillstand TEXT DEFAULT 'Aktiv'
);


`).run();





// Testdata (ta bort sen)


const count = db.prepare("SELECT COUNT(*) AS c FROM modul").get().c;

if (count === 0) {
    db.prepare(`
        INSERT INTO modul (kurskod, modulkod, benamning, tillstand)
        VALUES ('DB101', '005', 'Inlämningsuppgift', 'Aktiv')
    `).run();
    
    db.prepare(`
        INSERT INTO modul (kurskod, modulkod, benamning, tillstand)
        VALUES ('D0031N', '006', 'Projekt', 'Aktiv')
    `).run();
}








module.exports = {
   

    // Funktion som hämtar moduler tillhörande en kurskod

    getModulerByKurskod(kurskod) {

        return db.prepare(`

            SELECT modulkod, benamning
            FROM modul
            WHERE kurskod = ?
              AND tillstand = 'Aktiv'
        `).all(kurskod);


    }


};

